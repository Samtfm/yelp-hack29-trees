<html>
	<head>
		<title>Trees Two</title>
		<style>
			body { margin: 0; }
        </style>
		<script src="./two.js"></script>        
		<script src="./space-colonization.js"></script>        
	</head>
	<body>
        <div id='two-js-canvas'></div>
		<script>
            // init two
            var screenWidth = window.innerWidth
            var screenHeight = window.innerHeight
            var elem = document.getElementById('two-js-canvas');
            var params = { width: screenWidth, height: screenHeight };
            var two = new Two(params).appendTo(elem);

            rects = []

            var numTargets = 100;
            var captureRadius = 14;
            var branchLength = 10;
            var numJoints = 300;

            // Initialize random targets
            targets = []
            for (i = 0; i<numTargets; i++) {
                var radius = Math.random()*200 + 20;
                var angle = Math.random()*2*Math.PI // Random angle between 0 & 2Pi (a circle)
                x = Math.cos(angle)*radius;
                y = Math.sin(angle)*radius + 400;
                
                targets.push(new Node(x, y));
                rects.push({x: x, y: y, width: 5, height: 5, color: 'rgb(200, 80, 120)'})
            }

            // create tree
            startJoint = new Node(10,10);
            var tree = new Tree(targets, startJoint, captureRadius, branchLength, numJoints);
            
            // convert recursive structure to list of points
            function listPoints(node) {
                list = [{
                    x: node.x,
                    y: node.y,
                    width: 5,
                    height: 5,
                }]
                node.childNodes.forEach(child => {
                    list = list.concat(listPoints(child))
                });
                return list
            }

            jointList = []

            function paint() {
                var sceneObjects = []
                tree.remainingTargets.forEach(target => {
                    const newCircle = two.makeCircle(
                        target.x, 
                        target.y, 
                        captureRadius, 
                    );
                    newCircle.fill = 'rgb(255, 210, 220)';
                    newCircle.opacity = .5;
                    newCircle.noStroke();
                    sceneObjects.push(newCircle);
                })
     
                jointList.forEach(joint => {
                    if (!joint.parentJoint) return;
                    
                    var newLine = two.makeLine(joint.parentJoint.x, joint.parentJoint.y, joint.x, joint.y)
                    newLine.linewidth = 3;
                    newLine.stroke = 'rgb(80, 120, 40)';
                    newLine.opacity = 1;
                    sceneObjects.push(newLine);
                })

                // group objects, transform scene, flip y axis
                var sceneGroup = two.makeGroup(sceneObjects);
                sceneGroup.translation = new Two.Vector(screenWidth/2, screenHeight);
                sceneGroup._matrix.manual = true;
                sceneGroup._matrix
                    .identity()
                    .translate(sceneGroup.translation.x, sceneGroup.translation.y)
                    .rotate(sceneGroup.rotation)
                    .scale(1, -1);
            }

            function animate() {
                //grow tree
                const newJoint = tree.grow();
				if (newJoint) {
                    jointList.push(newJoint);
                }

                requestAnimationFrame( animate );
                two.clear();
                paint();
                two.update();
			};
			animate();

		</script>
	</body>
</html>